trigger:

    branches:
      include:
        - master

pr: none

pool:
    name: 'Unix'

jobs:
- job: henkem_kenya_ui_job
  variables:
  - group: FirebaseConfig

  steps:
  - powershell: |
      $env:API_KEY = "$(API_KEY)"
      $env:AUTH_DOMAIN = "$(AUTH_DOMAIN)"
      $env:DATABASE_URL = "$(DATABASE_URL)"
      $env:PROJECT_ID = "$(PROJECT_ID)"
      $env:STORAGE_BUCKET = "$(STORAGE_BUCKET)"
      $env:MESSAGING_SENDER_ID = "$(MESSAGING_SENDER_ID)"
      $env.APP_ID = "$(APP_ID)"
      $env.MEASUREMENT_ID = "$(MEASUREMENT_ID)"
    displayName: "Set Environment Variables"

  - task: NodeTool@0
    inputs:
      versionSpec: '18.x'
    displayName: 'Install Node.js'

  - task: NodeTool@0
    inputs:
      versionSpec: '18.x'
    displayName: 'Install dependancies'

  - script: |
      npm ci
    displayName: 'NPM CI'

  - task: NodeTool@0
    inputs:
      versionSpec: '18.x'
    displayName: 'Run project build'

  - script: |
      npm run build
    displayName: 'NPM RUN BUILD for first ui project'

  - task: ArchiveFiles@2
    displayName: 'Archive UI build files'
    inputs:
      rootFolderOrFile: '$(Build.SourcesDirectory)/dist'
      includeRootFolder: false
      archiveFile: '$(Build.ArtifactDirectory)/$(Build.BuildId).tar.gz'
      archiveType: 'tar'
      replaceExistingArchive: true

  - task: PublishPipelineArtifact@1
    displayName: 'Publish UI artifact'
    inputs:
      targetPath: '$(Build.ArtifactDirectory)/$(Build.BuildId).tar.gz'
      artifact: 'henkem_kenya_ui'
